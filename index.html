<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Work Calendar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0a0a0a;
        --fg: #e9e9ea;
        --muted: #a0a3a8;
        --card: #121214;
        --border: #222327;
        --weekend: #2c2d33;
        --done: #22c55e;
        --holiday-bg: #211214;
        --holiday-border: #3a1c21;

        /* размеры (десктоп) */
        --sidepad: 8px; /* одинаковые боковые поля у хедера и контента */
        --maxw: 1000px;
        --leftcol: 130px; /* ширина колонки Weekly earnings (и в хедере, и в сетке) */
        --gap: 6px; /* одинаковый gap у хедера и сетки */
        --size: 54px; /* диаметр кружков */
        --num-font: 18px;
        --icon-font: 28px;
        --datefont: 11px;
        --radius: 999px;

        --bar-bg: #101115;
        --bar-border: #23242a;

        --shadow: 0 6px 16px rgba(0, 0, 0, 0.28);
        --subtle: rgba(255, 255, 255, 0.06);

        --today-ring: #f5d34c;

        --sticky-bg: rgba(12, 12, 12, 0.92);
        --sticky-border: #161616;
        --sticky-shadow: 0 10px 22px rgba(0, 0, 0, 0.22);
        --sticky-inset: inset 0 1px 0 rgba(255, 255, 255, 0.02);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        overflow-x: hidden;
      }
      html {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }
      body {
        margin: 0;
        color: var(--fg);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Arial, sans-serif;
        display: flex;
        justify-content: center;
        padding: 0 12px 40px;

        background-color: var(--bg);
        background-image: radial-gradient(
            1200px 900px at 50% 10%,
            rgba(255, 255, 255, 0.03),
            transparent 60%
          ),
          linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.02) 0%,
            rgba(0, 0, 0, 0) 40%,
            rgba(255, 255, 255, 0.02) 60%,
            rgba(0, 0, 0, 0) 100%
          ),
          radial-gradient(
            1000px 700px at 78% 12%,
            rgba(62, 99, 255, 0.08),
            transparent 65%
          ),
          radial-gradient(
            900px 650px at 15% 5%,
            rgba(161, 71, 255, 0.06),
            transparent 60%
          ),
          url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='320' height='320' viewBox='0 0 320 320'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='2' stitchTiles='stitch'/><feColorMatrix type='saturate' values='0'/><feComponentTransfer><feFuncA type='table' tableValues='0 0 0 0.03'/></feComponentTransfer></filter><rect width='100%' height='100%' filter='url(%23n)'/></svg>");
        background-repeat: no-repeat, no-repeat, no-repeat, no-repeat, repeat;
        background-position: center top, center, right top, left top, 0 0;
        background-size: cover, 200% 200%, 120% 120%, 130% 130%, 320px 320px;
      }

      .wrap {
        width: min(var(--maxw), 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 0 var(--sidepad);
      }

      /* ── Sticky header ─────────────────────────────────────────────── */
      .sticky {
        position: sticky;
        top: 0;
        z-index: 50;
        background: var(--sticky-bg);
        border: 1px solid var(--sticky-border);
        border-radius: 14px;
        box-shadow: var(--sticky-shadow), var(--sticky-inset);
        margin-top: 8px;
        width: 100%;
        max-width: var(--maxw);
      }
      .sticky-inner {
        padding: 14px var(--sidepad) 12px;
      } /* синхрон с wrap */

      /* Progress */
      .progress {
        margin-bottom: 10px;
      }
      .progress-top {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: baseline;
        justify-content: space-between;
        margin-bottom: 6px;
        font-size: 13px;
        color: var(--muted);
      }
      .progress-nums,
      .earn-total {
        font-variant-numeric: tabular-nums;
        color: #fff;
        font-weight: 700;
      }
      .bar {
        width: 100%;
        height: 10px;
        background: var(--bar-bg);
        border: 1px solid var(--bar-border);
        border-radius: 999px;
        overflow: hidden;
        box-shadow: inset 0 1px 0 var(--subtle);
      }
      .bar-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #22c55e, #16a34a);
        transition: width 0.35s ease;
      }

      /* Header row (Mon..Sun) — те же колонки, что и у сетки */
      .header {
        display: grid;
        grid-template-columns: var(--leftcol) repeat(7, 1fr);
        gap: var(--gap);
        user-select: none;
        padding-top: 6px;
        justify-items: stretch;
        width: 100%;
        max-width: var(--maxw);
      }
      .weekday {
        text-align: center;
        font-size: 12px;
        color: var(--muted);
        letter-spacing: 0.3px;
        padding: 2px 0;
        white-space: nowrap;
      }
      .weekhead {
        font-size: 12px;
        color: var(--muted);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2px 0;
        white-space: nowrap;
      }

      /* Main grid (те же колонки и gap, гарантированное совпадение с хедером) */
      .grid {
        display: grid;
        grid-template-columns: var(--leftcol) repeat(7, 1fr);
        gap: var(--gap);
        padding-top: 12px;
        justify-items: stretch;
        width: 100%;
        max-width: var(--maxw);
      }

      /* Weekly earnings cell */
      .earn-cell {
        width: 100%;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, #151517, #101012);
        border-radius: 12px;
        padding: 10px 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        min-height: calc(var(--size) + 22px);
        box-shadow: var(--shadow);
      }
      .earn-val {
        width: 100%;
        color: #fff;
        font-weight: 700;
        font-variant-numeric: tabular-nums;
        font-size: 14px; /* было 14px — стало меньше */
        text-align: center;
        letter-spacing: 0.2px;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
        white-space: nowrap;
      }
      .earn-bar {
        width: 100%;
        height: 6px;
        background: var(--bar-bg);
        border: 1px solid var(--bar-border);
        border-radius: 999px;
        overflow: hidden;
      }
      .earn-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #22c55e, #16a34a);
        transition: width 0.35s ease;
      }

      /* Day cells */
      .cell {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        min-height: calc(var(--size) + 22px);
      }
      .circle {
        width: var(--size);
        height: var(--size);
        border: 1px solid var(--border);
        background: var(--card);
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        line-height: 1;
        user-select: none;
        font-size: var(--num-font);
        transition: background 0.2s, color 0.2s, border-color 0.2s,
          transform 0.1s, box-shadow 0.2s;
        box-shadow: var(--shadow);
        max-width: 100%;
      }
      .circle:hover {
        transform: translateY(-1px);
      }
      .today .circle {
        outline: 2px solid var(--today-ring);
        outline-offset: 2px;
        box-shadow: 0 0 0 3px rgba(245, 211, 76, 0.12), var(--shadow);
      }
      .date {
        margin-top: 5px;
        font-size: var(--datefont);
        color: var(--muted);
        line-height: 1;
        user-select: none;
        white-space: nowrap;
      }

      /* Weekend / Holiday / Done */
      .weekend .circle {
        background: var(--weekend);
        color: #d0d0d0;
        border-color: #47484f;
      }
      .weekend .circle:hover {
        transform: none;
      }

      .holiday .circle {
        background: var(--holiday-bg);
        border-color: var(--holiday-border);
        color: #fff;
        font-size: var(--icon-font);
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.45);
      }

      .done .circle {
        background: var(--done);
        color: #0c2618;
        border-color: var(--done);
        font-size: var(--icon-font);
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
      }

      .circle:focus-visible {
        outline: 2px solid #5ab0ff;
        outline-offset: 3px;
      }

      .earn-note {
        position: absolute;
        bottom: 2px;
        font-size: 11px;
        color: rgba(255, 255, 255, 0.35);
        font-variant-numeric: tabular-nums;
        pointer-events: none;
      }

      /* ── АДАПТИВ (iPhone и узкие) ───────────────────────────────────── */

      /* Планшеты */
      @media (max-width: 800px) {
        :root {
          --leftcol: 120px;
        }
      }

      /* Обычные телефоны (≤480px): уменьшаем только ниже хедера + синхронизация с хедером */
      @media (max-width: 480px) {
        :root {
          --sidepad: 6px; /* одинаковые поля => края сеток совпадают */
          --leftcol: clamp(78px, 22vw, 100px);
          --gap: clamp(2px, 1vw, 4px);

          /* диаметр из ширины вьюпорта:
           100vw - 2*sidepad - leftcol - 6*gap (между 7 днями)
        */
          --size: clamp(
            22px,
            calc(
              (
                  100vw - 2 * var(--sidepad) - var(--leftcol) - (7 - 1) *
                    var(--gap)
                ) / 7
            ),
            36px
          );

          /* шрифты и подписи меньшего размера */
          --num-font: clamp(12px, 3.2vw, 15px);
          --icon-font: clamp(18px, 5vw, 22px);
          --datefont: clamp(9px, 2.6vw, 10.5px);
        }
        .sticky-inner {
          padding: 12px var(--sidepad) 10px;
        }
        .bar {
          height: 8px;
        }
        .weekhead,
        .weekday {
          font-size: 11px;
        }
        .earn-val {
          font-size: 12px !important; /* было крупнее — теперь компактно */
          line-height: 1.05;
        }
        .earn-cell {
          padding: 8px 8px;
        }
        .date {
          margin-top: 4px;
        }
        .earn-note {
          font-size: 10px;
          bottom: 0px;
        }
      }

      /* Узкие (≤390px — SE/mini): ещё компактнее */
      @media (max-width: 390px) {
        :root {
          --sidepad: 4px;
          --leftcol: clamp(70px, 21vw, 92px);
          --gap: clamp(2px, 0.9vw, 3px);
          --size: clamp(
            20px,
            calc(
              (
                  100vw - 2 * var(--sidepad) - var(--leftcol) - (7 - 1) *
                    var(--gap)
                ) / 7
            ),
            32px
          );
          --num-font: clamp(11px, 3vw, 14px);
          --icon-font: clamp(16px, 4.8vw, 20px);
          --datefont: clamp(8.5px, 2.6vw, 10px);
        }
        .sticky {
          border-radius: 12px;
        }
        .sticky-inner {
          padding: 10px var(--sidepad) 8px;
        }
        .weekhead,
        .weekday {
          font-size: 10.5px;
        }
        .earn-val {
          font-size: 11px !important;
        }
        .date {
          margin-top: 3px;
        }
      }

      /* Совсем узкие (≤340px) */
      @media (max-width: 340px) {
        :root {
          --sidepad: 3px;
          --leftcol: clamp(64px, 20vw, 86px);
          --gap: 2px;
          --size: clamp(
            18px,
            calc(
              (
                  100vw - 2 * var(--sidepad) - var(--leftcol) - (7 - 1) *
                    var(--gap)
                ) / 7
            ),
            30px
          );
          --num-font: clamp(10px, 2.9vw, 13px);
          --icon-font: clamp(14px, 4.6vw, 18px);
          --datefont: 8.5px;
        }
        .weekhead,
        .weekday {
          font-size: 10px;
        }
        @media (max-width: 340px) {
          .earn-val {
            font-size: 10px !important;
          }
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap" aria-label="Work calendar">
      <!-- Sticky header -->
      <div class="sticky">
        <div class="sticky-inner">
          <div class="progress" aria-live="polite">
            <div class="progress-top">
              <div>Progress (working days only)</div>
              <div class="earn-total" id="earnTotal">$0</div>
              <div class="progress-nums" id="progressNums">0/0 (0%)</div>
            </div>
            <div
              class="bar"
              role="progressbar"
              aria-valuemin="0"
              aria-valuemax="100"
              aria-valuenow="0"
              aria-label="Workdays progress"
            >
              <div class="bar-fill" id="barFill" style="width: 0%"></div>
            </div>
          </div>

          <!-- Weekdays row: колонки совпадают с сеткой ниже -->
          <div class="header" aria-hidden="true">
            <div class="weekhead">Weekly earnings</div>
            <div class="weekday">Mon</div>
            <div class="weekday">Tue</div>
            <div class="weekday">Wed</div>
            <div class="weekday">Thu</div>
            <div class="weekday">Fri</div>
            <div class="weekday">Sat</div>
            <div class="weekday">Sun</div>
          </div>
        </div>
      </div>

      <!-- Grid -->
      <div id="grid" class="grid"></div>
    </div>

    <script>
      const TZ = "America/New_York";
      const DAILY_RATE = 125; // $ per payable day

      // Visible range: up to and including Mar 1, 2026 (Sun)
      const start = new Date("2025-10-06T00:00:00"); // Monday
      const endDisplay = new Date("2026-03-01T00:00:00"); // Sunday
      // Working/pay window for progress/earnings: Oct 6, 2025 -> Feb 27, 2026 (Fri)
      const workEnd = new Date("2026-02-27T00:00:00");

      // Holidays (unpaid unless in PAID_DAYS)
      const HOLIDAYS_ALL = new Set([
        "2025-10-30",
        "2025-11-03",
        "2025-11-27",
        "2025-11-28",
        "2025-12-25",
        "2025-12-26",
        "2026-01-01",
        "2026-01-02",
        "2025-12-15",
      ]);
      // Paid holidays (X icon but credited at 5 PM)
      const PAID_DAYS = new Set(["2025-11-27", "2025-12-25", "2026-01-01"]);

      const grid = document.getElementById("grid");
      const barFill = document.getElementById("barFill");
      const progressNums = document.getElementById("progressNums");
      const earnTotalEl = document.getElementById("earnTotal");

      const fmtTooltip = new Intl.DateTimeFormat("en-US", {
        weekday: "short",
        month: "short",
        day: "2-digit",
        year: "numeric",
        timeZone: TZ,
      });
      const fmtDay = new Intl.DateTimeFormat("en-US", {
        day: "2-digit",
        timeZone: TZ,
      });
      const fmtMonth = new Intl.DateTimeFormat("en-US", {
        month: "short",
        timeZone: TZ,
      });

      function ymdInNY(d) {
        const parts = new Intl.DateTimeFormat("en-CA", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          timeZone: TZ,
        }).formatToParts(d);
        const y = parts.find((p) => p.type === "year").value;
        const m = parts.find((p) => p.type === "month").value;
        const da = parts.find((p) => p.type === "day").value;
        return `${y}-${m}-${da}`;
      }
      function nowInNY() {
        return new Date(new Date().toLocaleString("en-US", { timeZone: TZ }));
      }

      // Build all visible dates
      const allDays = [];
      for (
        let d = new Date(start);
        d <= endDisplay;
        d.setDate(d.getDate() + 1)
      ) {
        allDays.push(new Date(d));
      }

      // Group by weeks (Mon..Sun)
      const weeks = [];
      for (let i = 0; i < allDays.length; i += 7)
        weeks.push(allDays.slice(i, i + 7));

      const workdayCells = [];
      const payableCells = [];
      const weekModels = [];

      // Render weeks
      weeks.forEach((weekDays) => {
        const earnCell = document.createElement("div");
        earnCell.className = "earn-cell";

        const earnVal = document.createElement("div");
        earnVal.className = "earn-val";
        earnVal.textContent = "$0 / $0";

        const earnBar = document.createElement("div");
        earnBar.className = "earn-bar";
        const earnFill = document.createElement("div");
        earnFill.className = "earn-fill";
        earnBar.appendChild(earnFill);

        earnCell.appendChild(earnVal);
        earnCell.appendChild(earnBar);
        grid.appendChild(earnCell);

        const model = {
          earnValEl: earnVal,
          earnFillEl: earnFill,
          target: 0,
          cells: [],
          payable: [],
        };

        // 7 day cells
        weekDays.forEach((date) => {
          const cell = document.createElement("div");
          cell.className = "cell";
          const ymd = ymdInNY(date);
          cell.dataset.ymd = ymd;

          const wd = date.getDay(); // 0 Sun .. 6 Sat
          const isWeekend = wd === 0 || wd === 6;
          const isHoliday = HOLIDAYS_ALL.has(ymd);
          const isPaidHoliday = PAID_DAYS.has(ymd);
          const withinWorkWindow = date <= workEnd;

          const circle = document.createElement("div");
          circle.className = "circle";
          circle.tabIndex = 0;

          // tooltip with paid/unpaid note
          let tip = fmtTooltip.format(date);
          if (isHoliday && isPaidHoliday) tip += " • Paid holiday";
          else if (isHoliday) tip += " • Unpaid holiday";
          circle.title = tip;

          const number = String(Number(fmtDay.format(date)));
          circle.textContent = number;
          circle.dataset.number = number;

          const dateLabel = document.createElement("div");
          dateLabel.className = "date";
          dateLabel.textContent = `${number} ${fmtMonth.format(date)}`;

          if (isHoliday) {
            cell.classList.add("holiday");
            circle.textContent = "✖";
            if (withinWorkWindow && isPaidHoliday) {
              model.payable.push(cell);
              payableCells.push(cell);
            }
          } else if (isWeekend) {
            cell.classList.add("weekend");
          } else {
            if (withinWorkWindow) {
              workdayCells.push(cell);
              model.payable.push(cell);
              payableCells.push(cell);
            }
          }

          cell.appendChild(circle);
          cell.appendChild(dateLabel);
          grid.appendChild(cell);

          model.cells.push(cell);
        });

        weekModels.push(model);
      });

      // Weekly targets
      weekModels.forEach((m) => {
        const targetDays = m.payable.length;
        m.target = targetDays * DAILY_RATE;
        m.earnValEl.textContent = `$0 / $${m.target}`;
        m.earnFillEl.style.width = "0%";
      });

      const TOTAL_WORKDAYS = workdayCells.length; // progress (workdays only)
      const TOTAL_PAYABLE = payableCells.length; // paid days incl. paid holidays
      const TOTAL_TARGET = TOTAL_PAYABLE * DAILY_RATE;

      function markToday() {
        document
          .querySelectorAll(".today")
          .forEach((el) => el.classList.remove("today"));
        const nyNow = nowInNY();
        const todayYMD = ymdInNY(nyNow);
        const todayCell = document.querySelector(
          `.cell[data-ymd="${todayYMD}"]`
        );
        if (todayCell) todayCell.classList.add("today");
      }

      function updateState() {
        const nyNow = nowInNY();
        const nyYMD = ymdInNY(nyNow);
        const hour = nyNow.getHours();

        let doneWorkdays = 0;
        let earnedTotal = 0;

        weekModels.forEach((m) => (m.earned = 0));

        // mark completed workdays (✔)
        workdayCells.forEach((cell) => {
          const ymd = cell.dataset.ymd;
          const circle = cell.querySelector(".circle");
          if (!circle) return;

          let isDone = false;
          if (ymd < nyYMD) isDone = true;
          else if (ymd === nyYMD && hour >= 17) isDone = true;

          if (isDone) {
            cell.classList.add("done");
            circle.textContent = "✔";
            doneWorkdays++;
          } else {
            cell.classList.remove("done");
            circle.textContent = circle.dataset.number;
          }
        });

        // earnings over all payable cells (workdays + paid holidays)
        payableCells.forEach((cell) => {
          const ymd = cell.dataset.ymd;
          let credited = false;
          if (ymd < nyYMD) credited = true;
          else if (ymd === nyYMD && hour >= 17) credited = true;

          if (credited) {
            earnedTotal += DAILY_RATE;
            const weekModel = weekModels.find((m) => m.cells.includes(cell));
            if (weekModel)
              weekModel.earned = (weekModel.earned || 0) + DAILY_RATE;
          }
        });

        // weekly panels
        weekModels.forEach((m) => {
          const earned = Math.min(m.earned || 0, m.target);
          const pct = m.target ? Math.round((earned / m.target) * 100) : 0;
          m.earnValEl.textContent = `$${earned} / $${m.target}`;
          m.earnFillEl.style.width = pct + "%";
        });

        // top progress (workdays only)
        const pctTotal = TOTAL_WORKDAYS
          ? Math.round((doneWorkdays / TOTAL_WORKDAYS) * 100)
          : 0;
        barFill.style.width = pctTotal + "%";
        barFill.parentElement.setAttribute("aria-valuenow", String(pctTotal));
        progressNums.textContent = `${doneWorkdays}/${TOTAL_WORKDAYS} (${pctTotal}%)`;

        // total earned text
        earnTotalEl.textContent = `Total earned: $${earnedTotal} / $${TOTAL_TARGET}`;

        markToday();
      }

      updateState();
      setInterval(updateState, 60_000);

      // Savings projection: +$500 weekly, -$500 first week each month except October
      const SAVINGS_START = 0;
      let savings = SAVINGS_START;

      weeks.forEach((weekDays, i) => {
        const earnCell = grid.children[i * 8]; // колонка недели + 7 дней (см. рендер сетки)
        earnCell.style.position = "relative";

        const note = document.createElement("div");
        note.className = "earn-note";

        const firstDay = weekDays[0];
        const month = firstDay.getMonth(); // 0=Jan ... 9=Oct
        const year = firstDay.getFullYear();

        // 1) Рента в первую неделю месяца (кроме октября 2025)
        const isFirstWeekOfMonth =
          firstDay.getDate() <= 7 && !(month === 9 && year === 2025);
        if (isFirstWeekOfMonth) savings -= 500;

        // 2) Доход приходит с лагом: за прошлую неделю
        if (i > 0) savings += 500;

        note.textContent = `~$${Math.max(0, savings).toLocaleString("en-US")}`;
        earnCell.appendChild(note);
      });
    </script>
  </body>
</html>
